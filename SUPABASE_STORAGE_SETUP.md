# Supabase Storage Setup Guide for Jehovah Jire Ministry

This guide will help you set up Supabase storage for your content management system.

## Step 1: Create Storage Bucket

1. Go to your Supabase dashboard
2. Navigate to **Storage** in the left sidebar
3. Click **"New bucket"**
4. Enter bucket name: `media` (case-sensitive)
5. Set **Public bucket** to **Yes** (so images can be accessed publicly)
6. Click **"Create bucket"**

## Step 2: Configure Bucket Policies

For the `media` bucket, you'll need to set up policies to allow operations:

1. In the Storage section, click on your `media` bucket
2. Go to **"Policies"** tab
3. Click **"New Policy"**
4. Create the following policies:

### For Reading:
- Policy Name: `Allow read access`
- For Operations: SELECT
- With Check: `true`

### For Writing:
- Policy Name: `Allow write access`
- For Operations: INSERT, UPDATE
- With Check: `true`

### For Deleting:
- Policy Name: `Allow delete access`
- For Operations: DELETE
- With Check: `true`

## Step 3: Update Database Tables

Run these SQL commands in your Supabase SQL Editor to ensure your tables are properly set up:

```sql
-- Create media table if it doesn't exist
CREATE TABLE IF NOT EXISTS media (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  key TEXT NOT NULL UNIQUE,
  value TEXT,
  alt_text TEXT,
  caption TEXT,
  file_type TEXT DEFAULT 'image',
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create content table if it doesn't exist
CREATE TABLE IF NOT EXISTS content (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  page TEXT NOT NULL,
  section TEXT NOT NULL,
  element_id TEXT,
  content_type TEXT DEFAULT 'html',
  content TEXT,
  sort_order INTEGER DEFAULT 0,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(page, section, element_id)
);

-- Create contact_info table if it doesn't exist
CREATE TABLE IF NOT EXISTS contact_info (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  contact_type TEXT NOT NULL, -- phone, email, address, social
  contact_value TEXT NOT NULL,
  label TEXT,
  is_primary BOOLEAN DEFAULT false,
  is_active BOOLEAN DEFAULT true,
  sort_order INTEGER DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Enable Row Level Security
ALTER TABLE media ENABLE ROW LEVEL SECURITY;
ALTER TABLE content ENABLE ROW LEVEL SECURITY;
ALTER TABLE contact_info ENABLE ROW LEVEL SECURITY;

-- Create policies to allow all operations (adjust as needed for production)
CREATE POLICY "Allow all operations on media" ON media FOR ALL USING (true);
CREATE POLICY "Allow all operations on content" ON content FOR ALL USING (true);
CREATE POLICY "Allow all operations on contact_info" ON contact_info FOR ALL USING (true);
```

## Step 4: Add Sample Contact Information

To add your phone number (0990342825) to the database, run this SQL:

```sql
INSERT INTO contact_info (contact_type, contact_value, label, is_primary, sort_order) 
VALUES ('phone', '0990342825', 'Primary Contact Number', true, 1)
ON CONFLICT (contact_type, contact_value) 
DO UPDATE SET 
  label = EXCLUDED.label,
  is_primary = EXCLUDED.is_primary,
  sort_order = EXCLUDED.sort_order,
  updated_at = NOW();
```

## Step 5: Verify Configuration

1. Check that your Supabase URL and key are correctly set in the JavaScript files
2. Test image upload functionality in the admin panel
3. Verify that contact information appears on your website
4. Confirm that all content updates are working properly

## Security Considerations

For production environments, consider updating the policies to be more restrictive:

```sql
-- More secure policies example
CREATE POLICY "Allow read access to media" ON storage.objects FOR SELECT USING (bucket_id = 'media');
CREATE POLICY "Allow insert for authenticated users" ON storage.objects FOR INSERT WITH CHECK (auth.role() = 'authenticated');
CREATE POLICY "Allow update for authenticated users" ON storage.objects FOR UPDATE USING (auth.role() = 'authenticated');
```

## Troubleshooting

- Make sure your bucket is named exactly `media`
- Verify that your Supabase URL and key are correct in the JavaScript files
- Check that your policies allow the necessary operations
- Ensure CORS settings allow your domain if needed
- Check browser console for any error messages

## Benefits of Using Supabase Storage:

- Secure file storage with CDN delivery
- Automatic image optimization
- Scalable cloud storage
- Integration with Supabase database
- Real-time updates across all users
- Proper access controls